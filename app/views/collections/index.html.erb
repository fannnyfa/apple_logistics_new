<div class="container mx-auto px-4 py-6">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-800">오늘의 수거 접수 현황</h1>
    <div class="space-x-2">
      <%= link_to "지난 접수", history_collections_path, class: "bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded" %>
      <%= link_to "새 접수", new_collection_path, class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
    </div>
  </div>

  <!-- 날짜 표시 -->
  <div class="mb-6">
    <h2 class="text-xl font-bold mb-4 text-gray-800 flex items-center gap-2">
      📅
      <%= @selected_date.strftime("%Y년 %m월 %d일") %> 
      <% if params[:status] == 'in_progress' %>
        접수 현황
      <% elsif params[:status] == 'completed' %>
        수거완료 현황
      <% else %>
        전체 현황
      <% end %>
    </h2>
  </div>

  <!-- 요약 정보 -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    <%= link_to collections_path, class: "block" do %>
      <div class="bg-white border border-gray-200 p-4 rounded-md hover:bg-gray-50 transition-colors cursor-pointer">
        <h3 class="font-semibold text-black">전체</h3>
        <p class="text-2xl font-bold text-black"><%= @summary[:in_progress_count] + @summary[:completed_count] %>건</p>
      </div>
    <% end %>
    <%= link_to collections_path(status: 'in_progress'), class: "block" do %>
      <div class="bg-white border border-gray-200 p-4 rounded-md hover:bg-gray-50 transition-colors cursor-pointer">
        <h3 class="font-semibold text-blue-800">접수</h3>
        <p class="text-2xl font-bold text-blue-600"><%= @summary[:in_progress_count] %>건</p>
      </div>
    <% end %>
    <%= link_to collections_path(status: 'completed'), class: "block" do %>
      <div class="bg-white border border-gray-200 p-4 rounded-md hover:bg-gray-50 transition-colors cursor-pointer">
        <h3 class="font-semibold text-green-800">수거완료</h3>
        <p class="text-2xl font-bold text-green-600"><%= @summary[:completed_count] %>건</p>
      </div>
    <% end %>
  </div>

  <!-- 📦 오늘 접수 물량 -->
  <div class="mb-6">
    <h2 class="text-xl font-bold mb-4 text-gray-800">📦 오늘 접수 물량</h2>
    
    <!-- 전체 물량 카드 -->
    <div class="bg-white border-2 border-blue-200 rounded-xl p-6 mb-6 shadow-sm">
      <div>
        <h3 class="text-lg font-semibold text-blue-800">전체 물량</h3>
        <p class="text-3xl font-bold text-blue-600 mt-1"><%= @summary[:total_quantity] %></p>
      </div>
    </div>
    
    <!-- 공판장별 물량 카드 -->
    <div class="bg-white border-2 border-gray-200 rounded-xl p-6 shadow-sm">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">공판장별 물량</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <% @summary[:by_market].each do |market_id, quantity| %>
          <% market = @markets.find(market_id) %>
          <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
            <h4 class="font-medium text-gray-800"><%= market.name %></h4>
            <p class="text-xl font-bold text-gray-700 mt-1"><%= quantity %></p>
            <span class="text-sm text-gray-500"><%= market.district %></span>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- 수거 목록 -->
  <div class="bg-white shadow rounded-lg overflow-hidden">
    <!-- 데스크톱 테이블 -->
    <div class="hidden md:block">
      <table class="min-w-full">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">농장명</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">수량</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">공판장</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">접수일시</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">상태</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">액션</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% @collections.each do |collection| %>
            <%= render 'collection_row', collection: collection %>
          <% end %>
        </tbody>
      </table>
    </div>

    <!-- 모바일 카드 뷰 -->
    <div class="md:hidden">
      <% @collections.each do |collection| %>
        <%= render 'collection_card', collection: collection %>
      <% end %>
    </div>
    
    <% if @collections.empty? %>
      <div class="text-center py-8 text-gray-500">
        선택한 날짜에 수거 접수가 없습니다.
      </div>
    <% end %>
  </div>
</div>
